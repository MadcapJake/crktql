(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))s(i);new MutationObserver(i=>{for(const n of i)if(n.type==="childList")for(const c of n.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&s(c)}).observe(document,{childList:!0,subtree:!0});function e(i){const n={};return i.integrity&&(n.integrity=i.integrity),i.referrerPolicy&&(n.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?n.credentials="include":i.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function s(i){if(i.ep)return;i.ep=!0;const n=e(i);fetch(i.href,n)}})();class g{constructor(){this.controllers={},this.animationFrameId=null,this.listeners={frame:[],connect:[],disconnect:[]},window.addEventListener("gamepadconnected",this.onGamepadConnected.bind(this)),window.addEventListener("gamepaddisconnected",this.onGamepadDisconnected.bind(this)),this.checkInterval=setInterval(this.scanGamepads.bind(this),500),window.addEventListener("click",()=>this.scanGamepads()),window.addEventListener("keydown",()=>this.scanGamepads())}scanGamepads(){const t=navigator.getGamepads?navigator.getGamepads():navigator.webkitGetGamepads?navigator.webkitGetGamepads():[];for(let e=0;e<t.length;e++)t[e]&&!this.controllers[t[e].index]&&this.onGamepadConnected({gamepad:t[e]})}onGamepadConnected(t){console.log("Gamepad connected",t.gamepad),this.controllers[t.gamepad.index]=t.gamepad,this.emit("connect",t.gamepad),Object.keys(this.controllers).length===1&&!this.animationFrameId&&(this.startPolling(),this.checkInterval&&(clearInterval(this.checkInterval),this.checkInterval=null))}onGamepadDisconnected(t){console.log("Gamepad disconnected",t.gamepad),delete this.controllers[t.gamepad.index],this.emit("disconnect",t.gamepad),Object.keys(this.controllers).length===0&&this.stopPolling()}startPolling(){const t=()=>{this.poll(),this.animationFrameId=requestAnimationFrame(t)};this.animationFrameId=requestAnimationFrame(t)}stopPolling(){this.animationFrameId&&(cancelAnimationFrame(this.animationFrameId),this.animationFrameId=null)}poll(){const t=navigator.getGamepads?navigator.getGamepads():navigator.webkitGetGamepads?navigator.webkitGetGamepads():[];for(let e=0;e<t.length;e++)if(t[e]){this.controllers[t[e].index]=t[e],this.emit("frame",t[e]);break}}on(t,e){this.listeners[t]&&this.listeners[t].push(e)}emit(t,e){this.listeners[t]&&this.listeners[t].forEach(s=>s(e))}}class R{constructor(){this.DEADZONE=.5,this.TRIGGER_THRESHOLD=.1}map(t){if(!t)return null;const e=l=>l&&(l.pressed||l.value>.5),s=l=>l?l.value:0;let i=0,n=1,c=2,o=3;t.mapping!=="standard"&&t.axes.length>=5&&(c=3,o=4);const f=s(t.buttons[6]),u=s(t.buttons[7]);t.axes.length>=6&&(f===0&&Math.abs(t.axes[2])>.1&&(t.axes[2]+1)/2,f===0&&t.buttons[6]&&t.buttons[6].pressed);let d=f,a=u;d===0&&t.axes[2]!==void 0&&t.axes[2]>-.9&&t.axes[2]>-1&&(d=(t.axes[2]+1)/2),a===0&&t.axes[5]!==void 0&&t.axes[5]>-.9&&t.axes[5]>-1&&(a=(t.axes[5]+1)/2);let T=10,r=11;return t.mapping!=="standard"&&t.axes.length>=5&&(T=9,r=10),{mode:{raw:{lt:d,rt:a},leftTrigger:d>this.TRIGGER_THRESHOLD,rightTrigger:a>this.TRIGGER_THRESHOLD,bothTriggers:d>this.TRIGGER_THRESHOLD&&a>this.TRIGGER_THRESHOLD},sticks:{left:this.processStick(t.axes[i],t.axes[n]),right:this.processStick(t.axes[c],t.axes[o])},buttons:{south:e(t.buttons[0]),east:e(t.buttons[1]),west:e(t.buttons[2]),north:e(t.buttons[3]),lb:e(t.buttons[4]),rb:e(t.buttons[5]),select:e(t.buttons[8]),start:e(t.buttons[9]),l3:e(t.buttons[T]),r3:e(t.buttons[r]),dpad:{up:e(t.buttons[12]),down:e(t.buttons[13]),left:e(t.buttons[14]),right:e(t.buttons[15])}}}}processStick(t,e){const s=Math.sqrt(t*t+e*e);if(s<this.DEADZONE)return{x:0,y:0,angle:0,magnitude:0,active:!1,sector:null};let n=Math.atan2(e,t)*(180/Math.PI);return n+=90,n<0&&(n+=360),{x:t,y:e,angle:n,magnitude:s,active:!0,sector:this.getSector(n)}}getSector(t){return t>=360-22.5||t<0+22.5?"NORTH":t>=45-22.5&&t<45+22.5?"NORTH_EAST":t>=90-22.5&&t<90+22.5?"EAST":t>=135-22.5&&t<135+22.5?"SOUTH_EAST":t>=180-22.5&&t<180+22.5?"SOUTH":t>=225-22.5&&t<225+22.5?"SOUTH_WEST":t>=270-22.5&&t<270+22.5?"WEST":t>=315-22.5&&t<315+22.5?"NORTH_WEST":null}}class v{constructor(){this.mapper=new R,this.state={mode:"ONSET",text:"",caseMode:0,syllable:{onset:null,vowel:null,coda:null},lastInput:null,leftStick:{sector:null,enterTime:0},rightStick:{sector:null,enterTime:0},modeSwitchTime:0},this.DWELL_THRESHOLD=60,this.mappings={ONSET:{LEFT:{NORTH:"h",NORTH_EAST:"k",EAST:"t",SOUTH_EAST:"c",SOUTH:"f",SOUTH_WEST:"s",WEST:"n",NORTH_WEST:"l"},RIGHT:{NORTH:"y",NORTH_EAST:"g",EAST:"d",SOUTH_EAST:"z",SOUTH:"b",SOUTH_WEST:"x",WEST:"m",NORTH_WEST:"w"}},RIME:{VOWELS:{NORTH:"i",NORTH_EAST:"û",EAST:"u",SOUTH_EAST:"ô",SOUTH:"o",SOUTH_WEST:"e",WEST:"ê",NORTH_WEST:"î"},CODA:{NORTH:"k",EAST:"t",SOUTH_EAST:"c",SOUTH_WEST:"s",WEST:"n",NORTH_WEST:"l"}},PUNCTUATION:{LEFT:{NORTH:";",NORTH_EAST:"“",EAST:"¿",SOUTH_EAST:",",SOUTH:"«",SOUTH_WEST:"<",WEST:null,NORTH_WEST:null},RIGHT:{NORTH:":",NORTH_EAST:"”",EAST:"?",SOUTH_EAST:".",SOUTH:"»",SOUTH_WEST:">"}}}}processFrame(t){const e=this.mapper.map(t);if(!e)return null;let s="ONSET";if(e.mode.bothTriggers?s="PUNCTUATION":e.mode.leftTrigger?s="RIME_LEFT":e.mode.rightTrigger&&(s="RIME_RIGHT"),this.state.mode!==s){if(s==="ONSET"&&(this.state.mode==="RIME_LEFT"||this.state.mode==="RIME_RIGHT")){let n=this.getFormattedSyllable();n.length>0&&(this.typeCharacter(n),this.consumeShift()),this.clearSyllable()}this.state.mode=s,this.state.modeSwitchTime=Date.now()}return this.handleStickInput(e,this.state.lastInput),this.handleButtons(e,this.state.lastInput),this.state.lastInput=e,this.state}handleStickInput(t,e){if(!e)return;const s=(i,n,c)=>{const o=t.sticks[i],f=e.sticks[i],u=this.state[`${i}Stick`];if(o.active&&o.sector){if(u.sector!==o.sector)u.sector=o.sector,u.enterTime=Date.now();else if(Date.now()-u.enterTime>this.DWELL_THRESHOLD&&u.enterTime>this.state.modeSwitchTime){const a=c[o.sector];a&&(this.state.syllable[n]=a)}}else u.sector=null,u.enterTime=0,this.state.mode.startsWith("RIME")&&(this.state.syllable[n]=null);if(f.active&&!o.active&&this.state.mode==="ONSET"&&n==="onset"&&this.state.syllable.onset){let d=this.getFormattedSyllable();this.typeCharacter(d+"o"),this.clearSyllable(),this.consumeShift()}};this.state.mode==="ONSET"?(s("left","onset",this.mappings.ONSET.LEFT),s("right","onset",this.mappings.ONSET.RIGHT),this.state.syllable.vowel=null,this.state.syllable.coda=null):this.state.mode==="RIME_LEFT"?(s("left","vowel",this.mappings.RIME.VOWELS),s("right","coda",this.mappings.RIME.CODA)):this.state.mode==="RIME_RIGHT"?(s("right","vowel",this.mappings.RIME.VOWELS),s("left","coda",this.mappings.RIME.CODA)):this.state.mode==="PUNCTUATION"&&(s("left","onset",this.mappings.PUNCTUATION.LEFT),s("right","onset",this.mappings.PUNCTUATION.RIGHT))}handleButtons(t,e){if(!e)return;const s=i=>t.buttons[i]&&!e.buttons[i];s("south")&&this.typeCharacter(" "),s("east")&&this.typeCharacter(`
`),s("west")&&this.deleteCharacter(),(s("l3")||s("r3"))&&(this.state.caseMode=(this.state.caseMode+1)%3,console.log("Case Mode:",["LOWER","SHIFT","CAPS"][this.state.caseMode]),this.forceUpdateBuffer())}forceUpdateBuffer(){["left","right"].forEach(t=>{var s;const e=(s=this.state.lastInput)==null?void 0:s.sticks[t];e&&e.active&&e.sector&&(this.state[`${t}Stick`].sector,e.sector)})}getFormattedSyllable(){const t=this.state.syllable,e=this.state.caseMode;let s=t.onset||"",i=t.vowel||"",n=t.coda||"";if(!s&&!i&&!n)return"";if(e===2)return(s+i+n).toUpperCase();if(e===1){if(s)return s.toUpperCase()+i+n;if(i)return i.toUpperCase()+n;if(n)return n.toUpperCase()}return s+i+n}typeCharacter(t){this.state.text+=t,console.log("Typed:",t)}deleteCharacter(){this.state.text=this.state.text.slice(0,-1)}consumeShift(){this.state.caseMode===1&&(this.state.caseMode=0)}clearSyllable(){this.state.syllable={onset:null,vowel:null,coda:null}}}class I{constructor(t){this.container=document.getElementById(t),this.leftJoy=this.container.querySelector("#left-joy"),this.rightJoy=this.container.querySelector("#right-joy"),this.createRadialSegments(this.leftJoy,"left"),this.createRadialSegments(this.rightJoy,"right")}createRadialSegments(t,e){const s=["NORTH","NORTH_EAST","EAST","SOUTH_EAST","SOUTH","SOUTH_WEST","WEST","NORTH_WEST"],i=document.createElement("div");i.className="segment-container",s.forEach((n,c)=>{const o=document.createElement("div");o.className=`segment segment-${c}`,o.dataset.sector=n;const f=document.createElement("span");f.className="segment-label",o.appendChild(f),i.appendChild(o)}),t.appendChild(i)}update(t,e,s){t&&(this.updateJoystick(this.leftJoy,t.sticks.left,e,s,"left"),this.updateJoystick(this.rightJoy,t.sticks.right,e,s,"right"))}updateJoystick(t,e,s,i,n){const c=t.querySelector(".stick-point"),o=30,f=e.x*o,u=e.y*o;c.style.transform=`translate(${f}px, ${u}px)`;const d=t.querySelectorAll(".segment");if(d.forEach(T=>{T.classList.remove("active");const r=T.querySelector(".segment-label");r.textContent=""}),e.active&&e.sector){const T=t.querySelector(`.segment[data-sector="${e.sector}"]`);T&&T.classList.add("active")}let a=null;s==="ONSET"?a=i.ONSET[n.toUpperCase()]:s==="RIME_LEFT"?(n==="left"&&(a=i.RIME.VOWELS),n==="right"&&(a=i.RIME.CODA)):s==="RIME_RIGHT"?(n==="right"&&(a=i.RIME.VOWELS),n==="left"&&(a=i.RIME.CODA)):s==="PUNCTUATION"&&(a=i.PUNCTUATION[n.toUpperCase()]),a&&d.forEach(T=>{const r=T.dataset.sector,l=a[r];l&&(T.querySelector(".segment-label").textContent=l.toUpperCase())})}}document.querySelector("#app").innerHTML=`
  <div class="container">
    <div class="header">
        <div id="mode-indicator">ONSET</div>
        <div id="case-indicator">LOWER</div>
    </div>
    
    <div class="editor-container">
        <textarea id="editor" readonly placeholder="Waiting for input..."></textarea>
    </div>

    <div class="visualizer" id="visualizer-container">
        <div class="joystick" id="left-joy">
            <div class="stick-point"></div>
            <div class="label">Left Stick</div>
        </div>
        <div class="joystick" id="right-joy">
            <div class="stick-point"></div>
            <div class="label">Right Stick</div>
        </div>
    </div>
    
    <div id="debug-status"></div>
  </div>
`;const O=new g,m=new v,H=new I("visualizer-container");window.addEventListener("gamepadconnected",h=>{const t=h.gamepad;O.handleConnect(t),console.log(`Gamepad connected at index ${t.index}: ${t.id}. ${t.buttons.length} buttons, ${t.axes.length} axes.`)});window.addEventListener("gamepaddisconnected",h=>{O.handleDisconnect(h.gamepad),console.log("Gamepad disconnected.")});O.on("frame",h=>{const t=m.processFrame(h);if(!t)return;const e=document.getElementById("editor");let s=t.text;const i=m.state.syllable,n=m.state.caseMode,c=(l,E)=>l&&(n===2||n===1&&E?l.toUpperCase():l),o=i.onset||"",f=i.vowel,u=i.coda||"";let d=c(o,!0),a=c(f||(t.mode.startsWith("RIME")?"-":""),!o),T=c(u,!o&&!f);t.mode==="ONSET"?i.onset&&(s+=`[${d}-]`):t.mode.startsWith("RIME")?s+=`[${d}${a}${T}]`:t.mode==="PUNCTUATION"&&i.onset&&(s+=`[${i.onset}]`),e.value!==s&&(e.value=s,e.scrollTop=e.scrollHeight),document.getElementById("mode-indicator").textContent=t.mode,document.getElementById("case-indicator").textContent=["LOWER","SHIFT","CAPS"][t.caseMode];const r=m.mapper.map(h);if(H.update(r,t.mode,m.mappings),r){const l=h.axes.map((S,p)=>`${p}:${S.toFixed(2)}`).join(" "),E=h.buttons.map((S,p)=>S.pressed?p:null).filter(S=>S!==null).join(", ");document.getElementById("debug-status").innerHTML=`
          Buttons: [${E}] <br>
          Raw Axes: ${l} <br>
          LT: ${r.mode.raw.lt.toFixed(2)} | RT: ${r.mode.raw.rt.toFixed(2)} <br>
          L-Stick: ${r.sticks.left.active?r.sticks.left.sector:"Center"} (${Math.round(r.sticks.left.angle)}°)<br>
          R-Stick: ${r.sticks.right.active?r.sticks.right.sector:"Center"} (${Math.round(r.sticks.right.angle)}°)
      `}});
